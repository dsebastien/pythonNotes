# Cheatsheet

Useful commands, tips and tricks.

## Connecting to the container
Log into the container using:

```
chmod +x ./util_connect.sh
./util_connec```
chmod +x ./util_start.sh
./util_start.sh
```t.sh
```

## Checking the logs
Look at the docker container logs using `docker logs app_main_1`

## Useful pipenv commands

* install: `pipenv install`
* install a dependency: `pipenv install <name>`
* lock: `pipenv lock`
* dependency graph: `pipenv graph`
* shell with the project's python environment active: `pipenv shell`

## Docker

Rebuilding the Web image with docker-compose: `docker-compose build`

Keep some battery life: `docker-compose down`

Troubleshooting image creation:

* retrieve the image id: `IMAGE_ID=$(docker build -q -t foo . 2>/dev/null | awk '/Successfully built/{print $NF}')`
* run a container with that image (or the last layer that worked): `docker run -it --rm <id> bash -il`

## Running the tests
Execute:

```
pipenv run test
```

## Commit hooks
We use https://pre-commit.com for commit hooks. This allows us to do all sorts of magic before/after committing changes (e.g., checking the code style).

To run those: `pre-commit run`

## Linting and code style/formatting
Python has a nice style guide: https://www.python.org/dev/peps/pep-0008/.

No need to discuss it much, BUT we can automate it using tools:

* Black: https://github.com/ambv/black. Automatically formats the code
* Flake8: http://flake8.pycqa.org/en/latest/. Checks/enforces the code style
  * With the bugbear plugin (to detect bugs: https://pypi.org/project/flake8-bugbear/

Both Black and Flake8 are executed via pre-commit hooks (see above).

To execute those manually:

* Run black: `pre-commit run black`
* Run Flake8: `pre-commit run flake8`
* Run for all files: `pre-commit run --all-files`
* Run mypy: `pre-commit run mypy`

## Environment variables

### For docker-compose
The .env file is used to configure environment variables for use within the docker-compose file, as explained here: https://vsupalov.com/docker-arg-env-variable-guide/.

The contents of that file are generated by the create.sh script.

### For the Docker container
The env_file is used to configure environment variables for the Docker container.

The contents of that file are generated by the util_create.sh script.
